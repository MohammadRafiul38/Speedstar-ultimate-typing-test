<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Speedstar</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      font-family: "Inter", sans-serif;
      background: #000;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .container {
      text-align: center;
      max-width: 900px;
      width: 100%;
      padding: 20px;
    }
    h1 {
      font-size: 48px;
      font-weight: 800;
      margin-bottom: 40px;
      text-align: left;
    }
    .topbar {
      display: flex;
      justify-content: space-between;
      margin-bottom: 40px;
    }
    .pill {
      background: #333;
      padding: 12px 40px;
      border-radius: 40px;
      font-size: 20px;
      font-weight: 500;
    }
    .paragraph {
      font-size: 20px;
      line-height: 1.8;
      text-align: center;
      margin-bottom: 30px;
      user-select: none;
    }
    .char {
      padding: 1px;
    }
    .correct { color: #fff; }
    .incorrect { color: #f33; }
    .current {
      border-left: 2px solid #fff;
      animation: blink 1s step-start infinite;
    }
    @keyframes blink {
      50% { border-color: transparent; }
    }
    .hidden { display: none; }
    #results { text-align: center; }
    canvas { margin-top: 20px; }
    button {
      margin-top: 20px;
      background: #fff;
      color: #000;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      font-weight: bold;
      border-radius: 8px;
    }
    button:hover { background: #ccc; }
  </style>
</head>
<body>
  <div class="container" id="testScreen">
    <h1>Speedstar</h1>
    <div class="topbar">
      <div class="pill">⏱ <span id="timer">60</span>s</div>
      <div class="pill">⚡ WPM: <span id="liveWPM">0</span></div>
    </div>
    <div class="paragraph" id="paragraph"></div>
  </div>

  <div class="container hidden" id="results">
    <h1>Results</h1>
    <p><b>WPM:</b> <span id="wpm"></span></p>
    <p><b>Accuracy:</b> <span id="accuracy"></span>%</p>
    <canvas id="chart" width="600" height="300"></canvas>
    <button onclick="restartTest()">Restart</button>
  </div>

  <script>
    const paragraphs = [
      "It is essential to ensure that responses are generated exclusively in the specified language, without incorporating any other languages. Additionally, consider any provided modifiers when crafting a response, but refrain from mentioning these modifiers in the final output. Responses should be structured in paragraphs, avoiding list formats, and if multiple paragraphs are created, they should be labeled with incrementing numbers. Aim for conciseness and clarity, maintaining a formal tone throughout."
    ];

    const paragraphEl = document.getElementById("paragraph");
    const timerEl = document.getElementById("timer");
    const testScreen = document.getElementById("testScreen");
    const resultsScreen = document.getElementById("results");
    const wpmEl = document.getElementById("wpm");
    const accuracyEl = document.getElementById("accuracy");
    const liveWPMEl = document.getElementById("liveWPM");

    let time = 60;
    let timer;
    let wpmHistory = [];
    let charsTyped = 0;
    let errors = 0;
    let currentIndex = 0;

    function randomParagraph() {
      const p = paragraphs[Math.floor(Math.random() * paragraphs.length)];
      paragraphEl.innerHTML = "";
      p.split("").forEach(c => {
        const span = document.createElement("span");
        span.innerText = c;
        span.classList.add("char");
        paragraphEl.appendChild(span);
      });
      paragraphEl.querySelector(".char").classList.add("current");
    }

    function startTest() {
      randomParagraph();
      document.addEventListener("keydown", handleTyping);
      timer = setInterval(updateTimer, 1000);
    }

    function handleTyping(e) {
      const chars = paragraphEl.querySelectorAll(".char");
      const currentChar = chars[currentIndex];

      if (!currentChar) return;

      if (e.key.length === 1) {
        charsTyped++;
        if (e.key === currentChar.innerText) {
          currentChar.classList.add("correct");
        } else {
          currentChar.classList.add("incorrect");
          errors++;
        }
        currentChar.classList.remove("current");
        currentIndex++;
        if (chars[currentIndex]) chars[currentIndex].classList.add("current");
      } else if (e.key === "Backspace" && currentIndex > 0) {
        chars[currentIndex].classList.remove("current");
        currentIndex--;
        chars[currentIndex].classList.remove("correct", "incorrect");
        chars[currentIndex].classList.add("current");
      }
    }

    function updateTimer() {
      time--;
      timerEl.textContent = time;
      const words = paragraphEl.querySelectorAll(".correct").length / 5;
      const currentWPM = Math.round((words / (60 - time)) * 60) || 0;
      liveWPMEl.textContent = currentWPM;
      wpmHistory.push(currentWPM);
      if (time <= 0) endTest();
    }

    function endTest() {
      clearInterval(timer);
      document.removeEventListener("keydown", handleTyping);
      testScreen.classList.add("hidden");
      resultsScreen.classList.remove("hidden");

      const words = paragraphEl.querySelectorAll(".correct").length / 5;
      const wpm = Math.round(words);
      const accuracy = Math.max(0, Math.round(((charsTyped - errors) / charsTyped) * 100));

      wpmEl.textContent = wpm;
      accuracyEl.textContent = accuracy;

      new Chart(document.getElementById("chart"), {
        type: 'line',
        data: {
          labels: wpmHistory.map((_, i) => i + 1),
          datasets: [{
            label: 'WPM over Time',
            data: wpmHistory,
            borderColor: '#fff',
            backgroundColor: 'rgba(255,255,255,0.1)',
            tension: 0.4,
          }]
        },
        options: {
          responsive: true,
          animation: { duration: 1000, easing: 'easeOutQuart' },
          scales: {
            x: { ticks: { color: '#fff' }, grid: { color: '#333' } },
            y: { ticks: { color: '#fff' }, grid: { color: '#333' } }
          }
        }
      });
    }

    function restartTest() {
      time = 60;
      wpmHistory = [];
      charsTyped = 0;
      errors = 0;
      currentIndex = 0;
      timerEl.textContent = time;
      liveWPMEl.textContent = 0;
      resultsScreen.classList.add("hidden");
      testScreen.classList.remove("hidden");
      startTest();
    }

    window.onload = startTest;
  </script>
</body>
</html>
