<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SpeedStar Typing Test</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: monospace;
      background: #000;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      flex-direction: column;
    }

    #container {
      width: 80%;
      max-width: 900px;
      text-align: center;
    }

    #stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      font-size: 18px;
    }

    #text {
      font-size: 28px;
      line-height: 2;
      text-align: left;
      margin-bottom: 40px;
      min-height: 120px;
    }

    .char { color: #666; }
    .char.correct { color: #fff; }
    .char.incorrect { color: #ff3333; }

    #result {
      display: none;
      font-size: 24px;
      margin-top: 40px;
      text-align: center;
    }

    button {
      margin-top: 20px;
      background: #111;
      color: #fff;
      border: 1px solid #444;
      padding: 10px 20px;
      cursor: pointer;
    }
    button:hover { background: #222; }

    /* On-screen keyboard */
    #keyboard {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 30px;
      gap: 4px;
    }
    .key {
      width: 40px;
      height: 40px;
      border: 1px solid #444;
      border-radius: 4px;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #111;
      color: #888;
      font-size: 14px;
    }
    .key.active { background: #fff; color: #000; }
  </style>
</head>
<body>
  <div id="container">
    <div id="stats">
      <div>Time: <span id="timer">60</span>s</div>
      <div>WPM: <span id="wpm">0</span></div>
    </div>

    <div id="text"></div>

    <div id="keyboard"></div>

    <div id="result">
      <h2>Results</h2>
      <p>WPM: <span id="finalWpm"></span></p>
      <p>Accuracy: <span id="accuracy"></span>%</p>
      <button onclick="resetTest()">Try Again</button>
    </div>
  </div>

  <script>
    const paragraphs = [
      "The quick brown fox jumps over the lazy dog.",
      "Typing fast requires focus and consistent practice every day.",
      "Dark themed apps are easy on the eyes and look super clean.",
      "Speed typing tests measure words per minute and accuracy.",
      "Monkeys love typing bananas on monkeytype dot com."
    ];

    const textEl = document.getElementById("text");
    const timerEl = document.getElementById("timer");
    const wpmEl = document.getElementById("wpm");
    const resultEl = document.getElementById("result");
    const finalWpmEl = document.getElementById("finalWpm");
    const accuracyEl = document.getElementById("accuracy");
    const keyboardEl = document.getElementById("keyboard");

    let time = 60;
    let timer = null;
    let started = false;
    let currentText = "";
    let currentIndex = 0;
    let correctChars = 0;
    let totalTyped = 0;

    // Build keyboard layout
    const keys = "abcdefghijklmnopqrstuvwxyz".split("");
    keys.forEach(k => {
      const div = document.createElement("div");
      div.classList.add("key");
      div.textContent = k;
      div.setAttribute("data-key", k);
      keyboardEl.appendChild(div);
    });

    function loadParagraph() {
      currentText = paragraphs[Math.floor(Math.random() * paragraphs.length)];
      textEl.innerHTML = "";
      currentText.split("").forEach(c => {
        const span = document.createElement("span");
        span.innerText = c;
        span.classList.add("char");
        textEl.appendChild(span);
      });
      currentIndex = 0;
    }

    function startTimer() {
      timer = setInterval(() => {
        time--;
        timerEl.textContent = time;
        if (time <= 0) {
          clearInterval(timer);
          endTest();
        }
      }, 1000);
    }

    document.addEventListener("keydown", e => {
      if (!started) {
        started = true;
        startTimer();
      }

      const chars = document.querySelectorAll(".char");

      // Skip non-character keys
      if (e.key.length !== 1) return;

      const typedChar = e.key;
      const expectedChar = currentText[currentIndex];

      totalTyped++;
      if (typedChar === expectedChar) {
        chars[currentIndex].classList.add("correct");
        correctChars++;
      } else {
        chars[currentIndex].classList.add("incorrect");
      }
      currentIndex++;

      if (currentIndex === currentText.length && time > 0) {
        loadParagraph();
      }

      updateWPM();

      // Keyboard highlight
      const keyDiv = document.querySelector(`.key[data-key="${typedChar.toLowerCase()}"]`);
      if (keyDiv) {
        keyDiv.classList.add("active");
        setTimeout(() => keyDiv.classList.remove("active"), 150);
      }
    });

    function updateWPM() {
      let minutes = (60 - time) / 60;
      let words = correctChars / 5;
      let wpm = minutes > 0 ? Math.round(words / minutes) : 0;
      wpmEl.textContent = wpm;
    }

    function endTest() {
      textEl.style.display = "none";
      keyboardEl.style.display = "none";
      resultEl.style.display = "block";

      let minutes = (60 - time) / 60;
      let words = correctChars / 5;
      let wpm = minutes > 0 ? Math.round(words / minutes) : 0;
      let accuracy = totalTyped > 0 ? Math.round((correctChars / totalTyped) * 100) : 0;

      finalWpmEl.textContent = wpm;
      accuracyEl.textContent = accuracy;
    }

    function resetTest() {
      time = 60;
      timerEl.textContent = time;
      started = false;
      correctChars = 0;
      totalTyped = 0;
      textEl.style.display = "block";
      keyboardEl.style.display = "flex";
      resultEl.style.display = "none";
      loadParagraph();
    }

    // init
    loadParagraph();
  </script>
</body>
</html>
